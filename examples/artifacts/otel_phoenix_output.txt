============================================================
OTEL/PHOENIX OBSERVABILITY DEMO
============================================================

ğŸŒ Phoenix UI: http://localhost:6006/
ğŸ“– Docs: https://arize.com/docs/phoenix

Tracing agent run for case: thyroid-001
----------------------------------------
  Latency: 2847ms
  Input tokens: 1523
  Output tokens: 412
  Eval score: 4.5/5

Span attributes recorded:
  - eval.case_id
  - eval.case_query
  - agent.success
  - agent.latency_ms
  - agent.input_tokens
  - agent.output_tokens
  - eval.framework
  - eval.score

============================================================
TRACE HIERARCHY (as seen in Phoenix UI)
============================================================

When running with PHOENIX_ENABLED=true, traces appear in the
Phoenix UI with this hierarchy:

eval_harness_run [run_id: abc-123-def]
â”œâ”€â”€ agent_run.langgraph [case: thyroid-001]
â”‚   â”œâ”€â”€ retrieval_search
â”‚   â”‚   â””â”€â”€ latency: 234ms, docs_retrieved: 5
â”‚   â”œâ”€â”€ llm_call
â”‚   â”‚   â””â”€â”€ model: gpt-4o-mini, tokens: 1935
â”‚   â””â”€â”€ output_validation
â”‚       â””â”€â”€ schema_valid: true
â”œâ”€â”€ schema_eval
â”‚   â””â”€â”€ passed: true, duration: 2ms
â”œâ”€â”€ judge_eval
â”‚   â””â”€â”€ score: 4.8, duration: 3421ms
â””â”€â”€ retrieval_eval
    â””â”€â”€ f1: 0.87, precision: 0.92, recall: 0.83

============================================================
KEY OBSERVABILITY FEATURES
============================================================

1. DISTRIBUTED TRACING
   - Every agent run creates a trace with child spans
   - LLM calls, retrieval, validation all tracked
   - Trace IDs link related operations

2. CUSTOM ATTRIBUTES
   - eval.case_id: Links trace to golden case
   - agent.latency_ms: End-to-end timing
   - agent.token_usage: Cost tracking
   - eval.score: Quality metrics

3. PHOENIX INTEGRATION
   - Automatic LLM call capture
   - Token usage visualization
   - Latency percentiles (p50, p95, p99)
   - Prompt/response inspection

4. SEMANTIC CONVENTIONS
   - Uses OpenTelemetry semantic conventions
   - Compatible with Jaeger, Zipkin, Datadog
   - Export to any OTLP-compatible backend

============================================================
USAGE
============================================================

# Enable Phoenix tracing
export PHOENIX_ENABLED=true

# Run evaluation with tracing
python -m agent_eval_pipeline.harness.runner

# View traces
open http://localhost:6006

============================================================
